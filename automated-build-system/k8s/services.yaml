apiVersion: v1
kind: Service
metadata:
  name: lulupay-build-system-service
  namespace: lulupay-production
  labels:
    app: lulupay-build-system
    component: service
    environment: production
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-backend-protocol: "http"
    service.beta.kubernetes.io/aws-load-balancer-ssl-cert: "arn:aws:acm:region:account:certificate/cert-id"
    service.beta.kubernetes.io/aws-load-balancer-ssl-ports: "https"
    prometheus.io/scrape: "true"
    prometheus.io/port: "9090"
    prometheus.io/path: "/metrics"
spec:
  type: LoadBalancer
  sessionAffinity: ClientIP
  sessionAffinityConfig:
    clientIP:
      timeoutSeconds: 3600
  selector:
    app: lulupay-build-system
    component: backend
    environment: production
  ports:
    - name: http
      port: 80
      targetPort: 3000
      protocol: TCP
    - name: https
      port: 443
      targetPort: 3000
      protocol: TCP
    - name: metrics
      port: 9090
      targetPort: 9090
      protocol: TCP

---
# Internal Service for inter-pod communication
apiVersion: v1
kind: Service
metadata:
  name: lulupay-build-system-internal
  namespace: lulupay-production
  labels:
    app: lulupay-build-system
    component: internal-service
    environment: production
spec:
  type: ClusterIP
  selector:
    app: lulupay-build-system
    component: backend
    environment: production
  ports:
    - name: http
      port: 3000
      targetPort: 3000
      protocol: TCP
    - name: metrics
      port: 9090
      targetPort: 9090
      protocol: TCP

---
# Headless Service for StatefulSet discovery
apiVersion: v1
kind: Service
metadata:
  name: lulupay-build-system-headless
  namespace: lulupay-production
  labels:
    app: lulupay-build-system
    component: headless-service
    environment: production
spec:
  type: ClusterIP
  clusterIP: None
  selector:
    app: lulupay-build-system
    component: backend
    environment: production
  ports:
    - name: http
      port: 3000
      targetPort: 3000
      protocol: TCP

---
# PostgreSQL Service
apiVersion: v1
kind: Service
metadata:
  name: postgresql-service
  namespace: lulupay-production
  labels:
    app: postgresql
    component: database
    environment: production
spec:
  type: ClusterIP
  selector:
    app: postgresql
    component: database
    environment: production
  ports:
    - name: postgresql
      port: 5432
      targetPort: 5432
      protocol: TCP

---
# Redis Service
apiVersion: v1
kind: Service
metadata:
  name: redis-service
  namespace: lulupay-production
  labels:
    app: redis
    component: cache
    environment: production
spec:
  type: ClusterIP
  selector:
    app: redis
    component: cache
    environment: production
  ports:
    - name: redis
      port: 6379
      targetPort: 6379
      protocol: TCP

---
# Redis Sentinel Service (for high availability)
apiVersion: v1
kind: Service
metadata:
  name: redis-sentinel-service
  namespace: lulupay-production
  labels:
    app: redis-sentinel
    component: cache-sentinel
    environment: production
spec:
  type: ClusterIP
  selector:
    app: redis-sentinel
    component: cache-sentinel
    environment: production
  ports:
    - name: sentinel
      port: 26379
      targetPort: 26379
      protocol: TCP

---
# Monitoring Service (for Prometheus metrics)
apiVersion: v1
kind: Service
metadata:
  name: lulupay-monitoring-service
  namespace: lulupay-production
  labels:
    app: lulupay-build-system
    component: monitoring
    environment: production
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9090"
    prometheus.io/path: "/metrics"
spec:
  type: ClusterIP
  selector:
    app: lulupay-build-system
    component: backend
    environment: production
  ports:
    - name: metrics
      port: 9090
      targetPort: 9090
      protocol: TCP

---
# WebSocket Service (for real-time build updates)
apiVersion: v1
kind: Service
metadata:
  name: lulupay-websocket-service
  namespace: lulupay-production
  labels:
    app: lulupay-build-system
    component: websocket
    environment: production
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-backend-protocol: "http"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
    nginx.ingress.kubernetes.io/websocket-services: "lulupay-websocket-service"
spec:
  type: ClusterIP
  sessionAffinity: ClientIP
  sessionAffinityConfig:
    clientIP:
      timeoutSeconds: 3600
  selector:
    app: lulupay-build-system
    component: backend
    environment: production
  ports:
    - name: websocket
      port: 8080
      targetPort: 8080
      protocol: TCP

---
# Build Queue Service (for build processing)
apiVersion: v1
kind: Service
metadata:
  name: lulupay-build-queue-service
  namespace: lulupay-production
  labels:
    app: lulupay-build-system
    component: build-queue
    environment: production
spec:
  type: ClusterIP
  selector:
    app: lulupay-build-system
    component: backend
    environment: production
  ports:
    - name: queue
      port: 6379
      targetPort: 6379
      protocol: TCP

---
# Asset Storage Service
apiVersion: v1
kind: Service
metadata:
  name: lulupay-asset-storage-service
  namespace: lulupay-production
  labels:
    app: lulupay-build-system
    component: asset-storage
    environment: production
spec:
  type: ClusterIP
  selector:
    app: lulupay-build-system
    component: backend
    environment: production
  ports:
    - name: storage
      port: 9000
      targetPort: 9000
      protocol: TCP

---
# Health Check Service
apiVersion: v1
kind: Service
metadata:
  name: lulupay-health-service
  namespace: lulupay-production
  labels:
    app: lulupay-build-system
    component: health
    environment: production
spec:
  type: ClusterIP
  selector:
    app: lulupay-build-system
    component: backend
    environment: production
  ports:
    - name: health
      port: 8888
      targetPort: 3000
      protocol: TCP

---
# Staging Environment Services
apiVersion: v1
kind: Service
metadata:
  name: lulupay-build-system-service-staging
  namespace: lulupay-staging
  labels:
    app: lulupay-build-system
    component: service
    environment: staging
spec:
  type: LoadBalancer
  selector:
    app: lulupay-build-system
    component: backend
    environment: staging
  ports:
    - name: http
      port: 80
      targetPort: 3000
      protocol: TCP
    - name: metrics
      port: 9090
      targetPort: 9090
      protocol: TCP

---
apiVersion: v1
kind: Service
metadata:
  name: postgresql-service-staging
  namespace: lulupay-staging
  labels:
    app: postgresql
    component: database
    environment: staging
spec:
  type: ClusterIP
  selector:
    app: postgresql
    component: database
    environment: staging
  ports:
    - name: postgresql
      port: 5432
      targetPort: 5432
      protocol: TCP

---
apiVersion: v1
kind: Service
metadata:
  name: redis-service-staging
  namespace: lulupay-staging
  labels:
    app: redis
    component: cache
    environment: staging
spec:
  type: ClusterIP
  selector:
    app: redis
    component: cache
    environment: staging
  ports:
    - name: redis
      port: 6379
      targetPort: 6379
      protocol: TCP 